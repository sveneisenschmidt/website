{{ $isPost := and (eq .Kind "page") (eq .Section "posts") }} {{ if $isPost }}

<div id="pop-wrapper">
    <a
        href="mailto:sven.eisenschmidt@gmail.com?subject=Feedback on {{ .Title }}"
    >
        Email me</a
    >
    or leave a reaction: <span id="pop"></span>
</div>
<hr />
{{ end }}
<script src="https://pop.eisenschmidt.website/pop.min.js" defer></script>
<script defer>
    document.addEventListener("DOMContentLoaded", function() {
        Pop.init({
            endpoint: "https://pop.eisenschmidt.website/api",
            pageId: {{ .Permalink }},
        {{ if $isPost }}
            el: "#pop",
            emojis: ["â¤ï¸", "ðŸ‘", "ðŸ’¡"],
            renderReactions: true,
            onLoad: function() {
                fetch(`${this.endpoint}/visits?pageId=${encodeURIComponent(this.pageId)}`)
                  .then(res => res.json())
                  .then(data => {
                    if (!data.totalVisits) return;
                    const time = document.querySelector('main h1 + time');
                    const label = data.totalVisits === 1 ? 'visit' : 'visits';
                    if (time) time.insertAdjacentText('beforeend', ' Â· ' + data.totalVisits + ' ' + label);
                  });
            },
        {{ end }}
            trackVisits: true
        });
    });
</script>
